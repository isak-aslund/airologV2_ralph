# Ralph Progress Log
Started: Sun Jan 25 22:17:42 CET 2026

## Codebase Patterns
- Use Python virtual environment `.venv/` for backend dependencies
- Run typecheck with: `source .venv/bin/activate && mypy backend/ --ignore-missing-imports`
- Test FastAPI server with: `uvicorn backend.main:app --host 127.0.0.1 --port 8000`
- pydantic-settings required for BaseSettings with env vars support in Pydantic v2
- ULog parsing: use `pyulog.ULog(file_path)` - timestamps in microseconds, GPS as int*1e7, params via `.initial_parameters`
- Router pattern: create `backend/routers/{module}.py` with `APIRouter(prefix="/api/{resource}", tags=["{resource}"])`, register in main.py
- Tags are always stored lowercase; use `get_or_create_tags(db, tag_names)` helper for tag creation
- Frontend: Run npm commands from `frontend/` directory; typecheck with `npx tsc --noEmit`, build with `npm run build`
- Frontend: TailwindCSS v4 uses `@import "tailwindcss";` in CSS (not @tailwind directives)

---

## 2026-01-25 - US-001
- What was implemented:
  - Created `backend/` directory with `__init__.py`
  - Created `backend/main.py` with FastAPI app instance and `/health` endpoint
  - Created `backend/requirements.txt` with fastapi, uvicorn, sqlalchemy, pyulog, python-multipart, pydantic, pydantic-settings
  - Created `backend/config.py` with Settings class (database path, upload dir, etc.)
  - Added `.gitignore` for Python/Node artifacts
- Files changed:
  - `backend/__init__.py` (new)
  - `backend/main.py` (new)
  - `backend/requirements.txt` (new)
  - `backend/config.py` (new)
  - `.gitignore` (new)
- **Learnings for future iterations:**
  - System uses externally-managed Python environment - must use venv
  - pydantic-settings is a separate package from pydantic in v2 (required for BaseSettings)
  - FastAPI config pattern: create Settings class in config.py, instantiate as singleton `settings`
- SQLAlchemy 2.0 uses DeclarativeBase and Mapped[] type annotations for models
- Use lifespan context manager in FastAPI for startup/shutdown events (not deprecated on_startup)
- Database init function should create parent directory before tables: `settings.DATABASE_PATH.parent.mkdir(parents=True, exist_ok=True)`
---

## 2026-01-25 - US-002
- What was implemented:
  - Created `backend/database.py` with SQLAlchemy engine, session factory, get_db dependency, and init_db function
  - Created `backend/models.py` with FlightLog model (UUID id, all required fields), Tag model (unique name), and flight_log_tags association table
  - Added lifespan context manager in `main.py` to auto-create database tables on startup
- Files changed:
  - `backend/database.py` (new)
  - `backend/models.py` (new)
  - `backend/main.py` (modified - added lifespan for database init)
- **Learnings for future iterations:**
  - SQLAlchemy 2.0 patterns: use `Mapped[T]` for type hints, `mapped_column()` for columns
  - DroneModel enum defined in models.py with values: XLT, S1, CX10
  - Association table uses `Table()` directly with ForeignKey references
  - Database stored at `data/flight_logs.db` (configurable via settings.DATABASE_PATH)
---

## 2026-01-25 - US-003
- What was implemented:
  - Created `backend/schemas.py` with all Pydantic schemas for API validation
  - FlightLogCreate, FlightLogUpdate, FlightLogResponse schemas for flight log operations
  - TagCreate, TagResponse schemas for tag operations
  - PaginatedResponse[T] generic schema for paginated list endpoints
  - StatsResponse schema with total_flights, total_hours, hours_by_model
- Files changed:
  - `backend/schemas.py` (new)
- **Learnings for future iterations:**
  - Pydantic v2 uses `model_config = ConfigDict(from_attributes=True)` instead of `class Config: orm_mode = True`
  - Generic schemas use `class MySchema(BaseModel, Generic[T])` pattern
  - Import DroneModel enum from models.py for type consistency across schemas
  - FlightLogResponse includes tags as `list[TagResponse]` for nested serialization
---

## 2026-01-25 - US-004
- What was implemented:
  - Created `backend/services/` directory with `__init__.py`
  - Created `backend/services/ulog_parser.py` with ULog metadata extraction functions
  - `extract_metadata(file_path)` returns dict with: duration_seconds, flight_date, serial_number (from AIROLIT_SERIAL), takeoff_lat, takeoff_lon
  - `get_parameters(file_path)` returns dict of all parameters from the ULog file
  - Duration calculated from start_timestamp to last_timestamp (microseconds to seconds)
  - GPS coordinates extracted from first valid (non-zero) vehicle_gps_position message
  - Graceful error handling: returns None for missing fields, empty dict for failed parameter extraction
- Files changed:
  - `backend/services/__init__.py` (new)
  - `backend/services/ulog_parser.py` (new)
- **Learnings for future iterations:**
  - pyulog.ULog attributes: `start_timestamp`, `last_timestamp` (microseconds), `initial_parameters` (dict), `get_dataset(name)` for message data
  - ULog timestamps are in microseconds since epoch
  - GPS coordinates in ULog stored as integers: degrees * 1e7
  - Use `ulog.get_dataset("vehicle_gps_position")` to get GPS data, access `.data["lat"]` and `.data["lon"]`
---

## 2026-01-25 - US-005
- What was implemented:
  - Created `backend/routers/` directory with `__init__.py`
  - Created `backend/routers/logs.py` with APIRouter for flight log CRUD operations
  - POST /api/logs - accepts multipart form (file + metadata), saves file to data/logs/{uuid}.ulg, extracts metadata, creates DB record
  - GET /api/logs/{id} - returns single log with tags
  - PUT /api/logs/{id} - updates editable fields (title, pilot, drone_model, comment, tags)
  - DELETE /api/logs/{id} - deletes DB record and .ulg file
  - GET /api/logs/{id}/download - returns file as attachment with descriptive filename
  - Registered router in main.py with `app.include_router(logs.router)`
- Files changed:
  - `backend/routers/__init__.py` (new)
  - `backend/routers/logs.py` (new)
  - `backend/main.py` (modified - added router import and include)
- **Learnings for future iterations:**
  - FastAPI router pattern: create APIRouter in routers/module.py, register via `app.include_router(router)`
  - Use prefix="/api/logs" on router for clean URL structure
  - For multipart forms with file upload, use `Form(...)` for metadata and `File(...)` for file
  - Tags passed as comma-separated string in form data, parsed in endpoint
  - Helper function `get_or_create_tags(db, tag_names)` centralizes tag creation logic (lowercase, dedupe)
  - FileResponse for downloads with `media_type="application/octet-stream"` for binary files
---

## 2026-01-25 - US-006
- What was implemented:
  - Added GET /api/logs endpoint with full pagination and filtering support
  - Pagination: page (default 1), per_page (25|50|100, default 25)
  - Search: case-insensitive search across title, pilot, comment, serial_number using SQLAlchemy ilike()
  - Filters: drone_model (comma-separated), pilot (exact match), tags (comma-separated, matches ALL specified tags), date_from/date_to (ISO format)
  - Returns PaginatedResponse with items, total, page, per_page, total_pages
  - Results ordered by flight_date descending (most recent first)
- Files changed:
  - `backend/routers/logs.py` (modified - added list_logs endpoint)
- **Learnings for future iterations:**
  - Use `Literal[25, 50, 100]` for per_page to restrict allowed values in FastAPI
  - Use `Query(default=..., description=...)` for optional query params with documentation
  - SQLAlchemy `ilike()` for case-insensitive search with wildcards
  - For tag filtering (ALL tags match), use multiple `.filter(FlightLog.tags.any(Tag.name == tag_name))` calls
  - Return type hint `dict` (not `PaginatedResponse[FlightLogResponse]`) to avoid type errors with ORM objects that FastAPI serializes via response_model
---

## 2026-01-25 - US-007
- What was implemented:
  - GET /api/logs/{id}/parameters - returns dict of all parameters from .ulg file
  - GET /api/stats - returns total_flights, total_hours (sum of duration_seconds / 3600), hours_by_model dict with XLT, S1, CX10 keys
  - GET /api/pilots - returns list of unique pilot names for autocomplete, sorted alphabetically
  - Created new `backend/routers/stats.py` for stats and pilots endpoints (at /api root, not /api/logs)
- Files changed:
  - `backend/routers/stats.py` (new)
  - `backend/routers/logs.py` (modified - added /api/logs/{id}/parameters endpoint)
  - `backend/main.py` (modified - registered stats router)
- **Learnings for future iterations:**
  - Stats and utility endpoints at /api root use separate router file (stats.py) with `prefix="/api"`
  - Use `sqlalchemy.func.count()` and `func.sum()` for aggregations
  - Iterate over DroneModel enum to get hours per model dynamically
  - For unique values, use `.distinct()` with `.order_by()` for sorted results
---

## 2026-01-25 - US-008
- What was implemented:
  - Created `backend/routers/tags.py` with APIRouter for tag management
  - GET /api/tags - returns all tags, ordered by name, with optional `search` param for case-insensitive filtering
  - POST /api/tags - creates new tag (stored lowercase), returns existing tag if duplicate
  - Registered tags router in `main.py`
- Files changed:
  - `backend/routers/tags.py` (new)
  - `backend/main.py` (modified - added tags router import and include)
- **Learnings for future iterations:**
  - Tags endpoint follows same router pattern as other resources: `APIRouter(prefix="/api/tags", tags=["tags"])`
  - POST returns 201 Created status even when returning existing tag (idempotent behavior)
  - Tag name uniqueness ensured at DB level (unique constraint) and API level (check before insert)
---

## 2026-01-25 - US-009
- What was implemented:
  - Added CORS middleware to `main.py` allowing localhost:5173 (Vite dev server) and localhost:8000 (FastAPI)
  - Mounted static files at `/img` path pointing to project `img/` directory using FastAPI StaticFiles
  - Added `data/logs/` directory creation in lifespan startup handler using `settings.UPLOAD_DIR.mkdir(parents=True, exist_ok=True)`
- Files changed:
  - `backend/main.py` (modified - added CORSMiddleware, StaticFiles, directory creation)
- **Learnings for future iterations:**
  - FastAPI CORS: import `CORSMiddleware` from `fastapi.middleware.cors`, use `app.add_middleware()` with origins list
  - Static files: import `StaticFiles` from `fastapi.staticfiles`, use `app.mount("/path", StaticFiles(directory=...), name=...)`
  - Directory creation should happen in lifespan handler before other startup tasks (like DB init)
---

## 2026-01-25 - US-010
- What was implemented:
  - Created `frontend/` directory with Vite + React + TypeScript scaffolding
  - Configured TailwindCSS using `@tailwindcss/vite` plugin (v4 approach)
  - Set up React Router with BrowserRouter, two routes: `/` (LogListPage), `/upload` (UploadPage)
  - Created `src/api/client.ts` with axios instance configured for `http://localhost:8000/api`
  - Added header component with navigation links (Logs, Upload button)
  - Cleaned up default Vite template files (removed demo content)
- Files changed:
  - `frontend/` (new - entire project directory)
  - `frontend/vite.config.ts` (added tailwindcss plugin)
  - `frontend/src/index.css` (TailwindCSS import)
  - `frontend/src/App.tsx` (router setup with header and routes)
  - `frontend/src/pages/LogListPage.tsx` (new)
  - `frontend/src/pages/UploadPage.tsx` (new)
  - `frontend/src/api/client.ts` (new)
- **Learnings for future iterations:**
  - TailwindCSS v4 with Vite: use `@tailwindcss/vite` plugin, import with `@import "tailwindcss";` in CSS
  - React Router v7: use BrowserRouter, Routes, Route, Link from `react-router-dom`
  - Axios client pattern: create instance with `axios.create({ baseURL: ... })` and export as default
  - Vite creates TypeScript config split into tsconfig.json, tsconfig.app.json, tsconfig.node.json
---

## 2026-01-25 - US-011
- What was implemented:
  - Created `frontend/src/types/index.ts` with TypeScript types matching backend API schemas
  - DroneModel union type: 'XLT' | 'S1' | 'CX10'
  - Tag interface with id and name
  - FlightLog interface with all fields including tags array
  - PaginatedResponse<T> generic interface for paginated endpoints
  - Stats interface with total_flights, total_hours, hours_by_model
  - Additional helper types: FlightLogCreate, FlightLogUpdate, TagCreate, LogListParams
- Files changed:
  - `frontend/src/types/index.ts` (new)
- **Learnings for future iterations:**
  - DateTime fields from Python API come as ISO strings in JSON, so use `string` type in TypeScript (not Date)
  - Optional fields with `| null` match Python's `Optional[T]` which can be explicitly None
  - Generic interface pattern: `interface PaginatedResponse<T> { items: T[]; ... }`
  - hours_by_model uses `Record<DroneModel, number>` for typed dict with known keys
---

## 2026-01-25 - US-012
- What was implemented:
  - Created `frontend/src/api/logs.ts` with functions: getLogs(params), getLog(id), createLog(formData), updateLog(id, data), deleteLog(id), downloadLog(id), getParameters(id)
  - Created `frontend/src/api/tags.ts` with functions: getTags(search?), createTag(name)
  - Created `frontend/src/api/stats.ts` with function: getStats()
  - Created `frontend/src/api/pilots.ts` with function: getPilots()
  - All functions properly typed using imported types from types/index.ts
- Files changed:
  - `frontend/src/api/logs.ts` (new)
  - `frontend/src/api/tags.ts` (new)
  - `frontend/src/api/stats.ts` (new)
  - `frontend/src/api/pilots.ts` (new)
- **Learnings for future iterations:**
  - API service pattern: create separate file per resource (logs.ts, tags.ts, etc.) for better organization
  - Use `export async function` for each API call, return `response.data` directly
  - For file downloads, use `responseType: 'blob'` in axios config
  - For file uploads with FormData, override Content-Type to 'multipart/form-data'
  - Import types from types/index.ts for consistent typing across API functions
---

## 2026-01-25 - US-013
- What was implemented:
  - Created `frontend/src/components/StatsHeader.tsx` component
  - Displays Total Flights count and Total Flight Hours (formatted as X.X hrs)
  - Displays hours by model (XLT, S1, CX10) with drone thumbnails from /img/{model}.png
  - Fetches stats from /api/stats on component mount using useEffect
  - Shows loading skeleton with animate-pulse while fetching
  - Error state handling with red error message
  - Updated LogListPage to include StatsHeader at top of page
- Files changed:
  - `frontend/src/components/StatsHeader.tsx` (new)
  - `frontend/src/pages/LogListPage.tsx` (modified - added StatsHeader import and component)
- **Learnings for future iterations:**
  - Component pattern: use useState for loading/error/data states with useEffect for initial fetch
  - Loading skeleton with TailwindCSS: use `animate-pulse` class with gray placeholder divs
  - Drone images served from FastAPI static files at `/img/{model}.png`
  - Use DRONE_MODELS constant array to iterate over models consistently
---

## 2026-01-25 - US-014
- What was implemented:
  - Created `frontend/src/components/FlightLogTable.tsx` with full table implementation
  - Table columns: Thumbnail (40x40), Model, Serial, Pilot, Title, Duration (HH:MM:SS), Tags, Comment, Date, Actions
  - Drone thumbnails loaded from `/img/{model}.png`
  - Comment truncated to 50 chars with `...` using helper function
  - Tags displayed as colored badges cycling through 8 color combinations
  - Date formatted as YYYY-MM-DD using ISO date extraction
  - Alternating row background colors (white/gray-50)
  - Duration formatted as HH:MM:SS from seconds
  - Loading skeleton component for loading state
  - Empty state with "No flight logs found" message
  - Action buttons: Edit, Delete, Download, Parameters, Flight Review (external link)
  - Updated LogListPage to fetch logs and render FlightLogTable with download handler
- Files changed:
  - `frontend/src/components/FlightLogTable.tsx` (new)
  - `frontend/src/pages/LogListPage.tsx` (modified - added FlightLogTable integration)
- **Learnings for future iterations:**
  - Table component pattern: accept logs array and callback props (onEdit, onDelete, etc.)
  - Tag colors: use array of color classes and cycle with modulo operator
  - File download: create temporary `<a>` element, set href to blob URL, trigger click, cleanup
  - Flight Review URL pattern: `http://10.0.0.100:5006/plot_app?log={filename}` with filename from file_path
---

## 2026-01-25 - US-015
- What was implemented:
  - Added Tooltip component to FlightLogTable for truncated comments
  - Tooltip shows full comment text on hover with 200ms delay
  - Styled with dark background (gray-900) and light text (white)
  - Tooltip disappears when mouse leaves
  - Modified truncateComment() to return an object with text, isTruncated flag, and original text
- Files changed:
  - `frontend/src/components/FlightLogTable.tsx` (modified - added Tooltip component, updated comment cell rendering)
- **Learnings for future iterations:**
  - Tooltip pattern: use useState for visibility with setTimeout for delay, clearTimeout on mouse leave
  - For conditional rendering with state, use IIFE in JSX: `{(() => { ... })()}`
  - Tooltip positioning: use `absolute bottom-full left-0 mb-2` to position above element
  - Arrow tip for tooltip: CSS border trick with transparent left/right borders and colored top border
---

## 2026-01-25 - US-016
- What was implemented:
  - Wired up all action button callbacks in LogListPage to make all buttons visible
  - The FlightLogTable already had the action buttons implemented (Edit, Delete, Download, Parameters, Flight Review)
  - Added placeholder handlers for onEdit, onDelete, onViewParameters that log to console
  - Download button was already functional, Flight Review external link was already working
  - All buttons have hover states (color changes) and tooltips (via HTML title attribute)
- Files changed:
  - `frontend/src/pages/LogListPage.tsx` (modified - added handleEdit, handleDelete, handleViewParameters, passed callbacks to FlightLogTable)
- **Learnings for future iterations:**
  - The FlightLogTable component was designed with optional callbacks that hide buttons when not provided
  - To show all action buttons, all callbacks must be passed even if they are placeholders
  - HTML `title` attribute provides basic tooltip functionality without additional libraries
  - Placeholder implementations with console.log help during development and can be wired to modals later
---

## 2026-01-25 - US-017
- What was implemented:
  - Created `frontend/src/components/Pagination.tsx` with full pagination controls
  - Previous and Next buttons with disabled states when at page bounds
  - Page number buttons with ellipsis for large page counts, current page highlighted in blue
  - "Page X of Y" text display showing current position
  - Per-page dropdown selector with options: 25, 50, 100
  - onPageChange and onPerPageChange callback props for parent state management
  - Smart page number generation that shows first/last page and pages around current page
- Files changed:
  - `frontend/src/components/Pagination.tsx` (new)
- **Learnings for future iterations:**
  - Pagination component pattern: accept page, totalPages, perPage props and callback functions
  - Page number rendering with ellipsis: always show first/last pages, ellipsis when gap > 1
  - Use union type `25 | 50 | 100` for strict per_page typing matching backend API
  - Select onChange returns string, must cast with `Number(e.target.value) as 25 | 50 | 100`
---

## 2026-01-25 - US-018
- What was implemented:
  - Created `frontend/src/components/SearchBar.tsx` with full search functionality
  - Text input with search icon (magnifying glass SVG)
  - 300ms debounced search on typing using useRef for timer management
  - Immediate search on Enter key press (clears debounce timer)
  - Clear button (X icon) appears when text is entered
  - Clear button resets search input and triggers empty search
  - initialValue prop for syncing with external state (e.g., URL params)
- Files changed:
  - `frontend/src/components/SearchBar.tsx` (new)
- **Learnings for future iterations:**
  - Debounce pattern: use useRef for timer to avoid stale closure issues, cleanup on unmount
  - For immediate action (Enter/clear), cancel pending debounce timer first
  - Use ReturnType<typeof setTimeout> for cross-platform timer type compatibility
  - SVG icons inline with currentColor for easy color inheritance from parent
---

## 2026-01-25 - US-019
- What was implemented:
  - Created `frontend/src/components/FilterPanel.tsx` with full filter functionality
  - Collapsible panel with toggle button (chevron rotates on expand/collapse)
  - "Active" badge appears when any filters are set
  - Date range inputs: From date and To date using HTML date inputs
  - Drone model checkboxes: XLT, S1, CX10 with checkbox inputs
  - Pilot dropdown populated from /api/pilots on mount
  - Clear All Filters button (only visible when filters are active)
  - Responsive grid layout (1 col mobile, 2 col md, 4 col lg)
- Files changed:
  - `frontend/src/components/FilterPanel.tsx` (new)
- **Learnings for future iterations:**
  - FilterPanel exports `FilterState` interface for parent components to manage filter state
  - Pattern: pass filter state down via props, update via callback `onFilterChange(filters)`
  - Collapsible panels: use `isExpanded` state with CSS `rotate-180` transform for chevron animation
  - hasActiveFilters computed property to show "Active" badge and Clear button conditionally
---

## 2026-01-25 - US-020
- What was implemented:
  - Added tag filter with multi-select dropdown to FilterPanel component
  - Dropdown fetches all tags from `/api/tags` on component mount
  - Search input inside dropdown filters the tag list in real-time
  - Selected tags displayed as removable chips below the dropdown
  - Updated `FilterState` interface to include `tags: string[]`
  - Added click-outside handler to close dropdown
  - Updated grid layout to accommodate 5 columns on xl screens
- Files changed:
  - `frontend/src/components/FilterPanel.tsx` (modified - added tag filter)
- **Learnings for future iterations:**
  - Multi-select dropdown pattern: use useState for dropdown visibility, useRef for click-outside detection
  - Click-outside: add mousedown event listener on document, check if target is within ref.current
  - Tag chips: use `inline-flex items-center gap-1` with X button for removable chips
  - FilterState.tags is string[] (tag names), not Tag[] objects - consistent with API params
---

## 2026-01-25 - US-021
- What was implemented:
  - Created `frontend/src/components/ActiveFilterChips.tsx` component
  - Displays active filters as chips below search bar with filter type and value
  - Format: 'Model: XLT', 'Pilot: John', 'Tag: tagname', 'Date: YYYY-MM-DD to YYYY-MM-DD'
  - Date range shown as single chip when both dates are set, separate chips for From/To otherwise
  - Each chip has X button to remove that specific filter
  - Updated LogListPage to integrate all components: StatsHeader, SearchBar, ActiveFilterChips, FilterPanel, FlightLogTable, Pagination
  - Added full state management for search, filters, pagination with API integration
- Files changed:
  - `frontend/src/components/ActiveFilterChips.tsx` (new)
  - `frontend/src/pages/LogListPage.tsx` (modified - added filter/search/pagination state and integrated all components)
- **Learnings for future iterations:**
  - ActiveFilterChips receives onRemoveFilter callback with (type, value?) for precise filter removal
  - When removing date range chip, clear both dateFrom and dateTo for better UX
  - Use `useCallback` for fetchLogs to properly handle dependency array in useEffect
  - Reset page to 1 when search/filters change to avoid showing empty results
---

## 2026-01-25 - US-022
- What was implemented:
  - US-022 requirements were already fully implemented during US-021
  - LogListPage.tsx already integrates all required components: StatsHeader, SearchBar, FilterPanel, FlightLogTable, Pagination
  - Full state management for: page, perPage, search, filters (drone_model, pilot, tags, date_from, date_to)
  - Fetches logs when any state changes via useCallback and useEffect
  - Shows loading state while fetching (passed to FlightLogTable)
  - Verified typecheck passes
- Files changed:
  - None (already complete from US-021)
- **Learnings for future iterations:**
  - US-021 ActiveFilterChips integration included full state management setup
  - Typecheck verified with `cd frontend && npx tsc --noEmit`
---

## 2026-01-25 - US-023
- What was implemented:
  - Added URL state synchronization to LogListPage using `useSearchParams` from react-router-dom
  - All filter state (search, drone_model, pilot, tags, date_from, date_to, page, per_page) synced to URL query params
  - Page loads with filters from URL if present (via parse functions)
  - Browser back/forward navigates filter history (using `replace: false` in setSearchParams)
  - Sharing URL preserves filter state
  - Default values (page=1, per_page=25) are omitted from URL for cleaner URLs
- Files changed:
  - `frontend/src/pages/LogListPage.tsx` (modified - replaced local state with URL-based state)
- **Learnings for future iterations:**
  - Use `useSearchParams` from react-router-dom for URL state sync
  - `useMemo` for derived filter state from searchParams to avoid unnecessary re-renders
  - Pattern: `setSearchParams((prev) => {...}, { replace: false })` enables browser history navigation
  - Omit default values from URL for cleaner shareable links
  - Use type guards like `(m): m is DroneModel => DRONE_MODELS.includes(m as DroneModel)` for safe parsing
---

## 2026-01-25 - US-024
- What was implemented:
  - Created `frontend/src/components/DeleteConfirmModal.tsx` component
  - Modal shows log title with warning message about permanent deletion
  - Warning icon with red background for visual emphasis
  - Cancel button closes modal (also closes on backdrop click)
  - Delete button calls deleteLog API and closes modal on success
  - Shows error message in red alert box if delete fails
  - Loading state with spinner during delete operation
  - Buttons disabled during loading to prevent double-submission
  - Integrated modal into LogListPage with state management
  - Table refreshes after successful delete via fetchLogs() callback
- Files changed:
  - `frontend/src/components/DeleteConfirmModal.tsx` (new)
  - `frontend/src/pages/LogListPage.tsx` (modified - added modal import, state, and integration)
- **Learnings for future iterations:**
  - Modal pattern: use fixed inset-0 for full-screen overlay with z-50 for stacking
  - Backdrop click to close: add onClick handler on backdrop div, not the modal container
  - Loading state in modals: disable all buttons during async operations
  - onDeleted callback pattern: close modal and trigger parent refresh
---

## 2026-01-25 - US-032
- What was implemented:
  - Added responsive layout support for tablet and desktop screen sizes
  - FlightLogTable: Table uses `min-w-[900px] lg:min-w-full` to force horizontal scroll on screens < 1024px
  - FilterPanel: Uses window width check on mount to collapse by default on screens < 768px
  - StatsHeader: Uses `flex-col sm:flex-row` pattern to stack vertically on small screens
  - App.tsx header: Responsive font sizes, padding, and gap adjustments using sm: breakpoints
  - UploadPage: Responsive container padding and heading sizes
  - Minimum supported width of 320px already set in index.css body rule
- Files changed:
  - `frontend/src/components/FlightLogTable.tsx` (modified - added min-width constraint)
  - `frontend/src/components/FilterPanel.tsx` (modified - responsive initial state)
  - `frontend/src/components/StatsHeader.tsx` (modified - responsive flex layout)
  - `frontend/src/App.tsx` (modified - responsive header)
  - `frontend/src/pages/UploadPage.tsx` (modified - responsive padding)
- **Learnings for future iterations:**
  - Horizontal scroll pattern: use `overflow-x-auto` on wrapper + explicit `min-w-[Xpx]` on table
  - Responsive initial state pattern: use function initializer in useState with window.innerWidth check
  - TailwindCSS responsive: stack with `flex-col sm:flex-row`, adjust gaps with `gap-4 sm:gap-6`
  - Small screen adaptations: smaller text `text-lg sm:text-xl`, smaller padding `px-3 sm:px-4`
---

## 2026-01-25 - US-025
- What was implemented:
  - Created `frontend/src/components/ParameterModal.tsx` for viewing flight parameters
  - Modal fetches parameters from `/api/logs/{id}/parameters` using `getParameters` API function
  - Loading spinner shown while fetching with animate-spin SVG
  - Scrollable table displays parameters with Name and Value columns
  - Search input filters parameters by name (case-insensitive)
  - Close button (X) in header and Close button in footer to dismiss modal
  - Parameters sorted alphabetically by name
  - Shows count of displayed parameters vs total (e.g., "X of Y parameters")
  - Integrated modal into LogListPage with state management for parameterModalLog
- Files changed:
  - `frontend/src/components/ParameterModal.tsx` (new)
  - `frontend/src/pages/LogListPage.tsx` (modified - added modal import and integration)
- **Learnings for future iterations:**
  - Modal pattern: use flex-col with max-h-[80vh] and flex-1 overflow-y-auto for scrollable content area
  - Parameter table uses font-mono for values for better readability of numeric/technical data
  - Use sticky top-0 on thead for fixed header in scrollable table
  - Filter with useMemo for performance when filtering large parameter lists
---

## 2026-01-25 - US-033
- What was implemented:
  - Created `frontend/src/lib/mavlink.ts` with full MAVLink v2 protocol implementation
  - `MAVLinkParser` class for parsing MAVLink v2 messages from byte stream with state machine
  - `createHeartbeatMessage()` for GCS heartbeat to maintain drone connection
  - `createLogRequestListMessage()` for requesting available logs from drone
  - `createLogRequestDataMessage()` for requesting log data chunks
  - `parseLogEntry()` for parsing LOG_ENTRY responses (log metadata: id, size, time_utc, etc.)
  - `parseLogData()` for parsing LOG_DATA responses (actual log content)
  - `parseHeartbeat()` for parsing HEARTBEAT messages
  - Full CRC-16/MCRF4XX checksum calculation and verification
  - Message ID constants and component ID constants exported
- Files changed:
  - `frontend/src/lib/mavlink.ts` (new)
- **Learnings for future iterations:**
  - MAVLink v2 header structure: STX(1) + len(1) + incompat(1) + compat(1) + seq(1) + sysid(1) + compid(1) + msgid(3) = 10 bytes
  - CRC is calculated over header bytes 1-9 + payload + CRC_EXTRA seed specific to each message type
  - LOG_DATA payload: id(2) + ofs(4) + count(1) + data[90] - count indicates actual bytes in data
  - Multi-byte fields in MAVLink are little-endian
  - Use state machine pattern for parsing streaming protocol data (IDLE -> HEADER -> PAYLOAD -> CRC)
---

## 2026-01-25 - US-034
- What was implemented:
  - Created `frontend/src/lib/droneConnection.ts` for Web Serial API connection management
  - `DroneConnection` class with full connection lifecycle management (connect, disconnect, cleanup)
  - `requestPort()` function with USB vendor ID filters for common PX4 flight controllers
  - Connection at 115200 baud rate using Web Serial API
  - Periodic heartbeat sending (every 1 second) to maintain drone connection
  - Async read loop that receives and parses incoming MAVLink messages using MAVLinkParser
  - Event-driven architecture with callbacks: onStateChange, onHeartbeat, onLogEntry, onLogData, onError, onMessage
  - `isWebSerialSupported()` helper function for feature detection
  - Singleton pattern with `getDroneConnection()` for global access
- Files changed:
  - `frontend/src/lib/droneConnection.ts` (new)
- **Learnings for future iterations:**
  - Web Serial API: use `navigator.serial.requestPort({ filters })` with USB vendor IDs for device filtering
  - Connection flow: requestPort() -> port.open({ baudRate }) -> getReader()/getWriter() -> start read loop
  - Cleanup pattern: stop intervals first, then cancel reader, release locks, close port
  - Common PX4 USB vendor IDs: 0x26ac (Hex), 0x3185 (CUAV), 0x2dae (Holybro), 0x0483 (STM), 0x1209 (3DR)
  - Use `ReadableStreamDefaultReader<Uint8Array>` type for serial port reader
---

## 2026-01-25 - US-035
- What was implemented:
  - Created `frontend/src/components/DroneConnection.tsx` for drone connection UI
  - Connect Drone button in header (only visible if Web Serial API is supported)
  - Status indicator: gray (disconnected), yellow pulsing (connecting), green (connected)
  - Displays drone system ID as serial number when connected (e.g., "SYS-1")
  - Disconnect button with red styling when connected
  - Error message appears below button with auto-dismiss after 5 seconds
  - Created `frontend/src/types/web-serial.d.ts` for Web Serial API TypeScript declarations
  - Fixed type imports in droneConnection.ts to use `import type` syntax for verbatimModuleSyntax compliance
  - Integrated DroneConnection component into App.tsx header navigation
- Files changed:
  - `frontend/src/components/DroneConnection.tsx` (new)
  - `frontend/src/types/web-serial.d.ts` (new)
  - `frontend/src/App.tsx` (modified - added DroneConnection import and component)
  - `frontend/src/lib/droneConnection.ts` (modified - fixed type imports)
- **Learnings for future iterations:**
  - Web Serial API requires type declarations: create `web-serial.d.ts` with SerialPort, Serial, Navigator interface extensions
  - Use `import type { X }` syntax for type-only imports when verbatimModuleSyntax is enabled
  - DroneConnection uses singleton pattern via `getDroneConnection()` for consistent connection state
  - Event callbacks are set via `connection.setEventHandlers({...})` - handlers receive typed messages
  - Connection status visualized with colored dots: green=connected, yellow=connecting, gray=disconnected
---

## 2026-01-25 - US-036
- What was implemented:
  - Added `requestLogList()` method to `DroneConnection` class in `frontend/src/lib/droneConnection.ts`
  - Function sends LOG_REQUEST_LIST MAVLink message to the connected drone
  - Collects LOG_ENTRY responses and builds an array of log entries
  - Each log entry contains: id, size, timeUtc (Unix timestamp in seconds)
  - Handles timeout (5 seconds) if drone doesn't respond
  - Returns partial results if some entries were received before timeout
  - Exports `DroneLogEntry` interface for type-safe log list handling
  - Logs are sorted by ID descending (most recent first)
- Files changed:
  - `frontend/src/lib/droneConnection.ts` (modified - added requestLogList method and DroneLogEntry interface)
- **Learnings for future iterations:**
  - MAVLink log list protocol: send LOG_REQUEST_LIST, receive multiple LOG_ENTRY responses
  - LOG_ENTRY messages contain numLogs field indicating total expected entries
  - Entries with size=0 are empty slots and should be filtered out
  - Use Promise pattern with event handler interception for async MAVLink request/response flows
  - Always restore original event handlers in cleanup to avoid handler leaks
---

## 2026-01-25 - US-037
- What was implemented:
  - Created `frontend/src/components/DroneLogsPanel.tsx` for displaying and selecting drone logs
  - Panel only appears when drone is connected (checks connection state on render)
  - Shows log list table with ID, Date, Size columns
  - Checkbox selection for each log with clickable rows for convenience
  - Select All / Deselect All buttons in header
  - Refresh button with spinning animation during fetch
  - Loading state with spinner while fetching logs from drone
  - Error state display with error message
  - Empty state when no logs found on drone
  - Selection count footer showing number of selected logs
  - Integrated panel into LogListPage between filter panel and flight log table
- Files changed:
  - `frontend/src/components/DroneLogsPanel.tsx` (new)
  - `frontend/src/pages/LogListPage.tsx` (modified - added DroneLogsPanel import and integration)
- **Learnings for future iterations:**
  - Panel component pattern: use singleton `getDroneConnection()` to track state and access connection methods
  - Auto-fetch logs when connection state changes to 'connected' using useEffect dependency
  - Format helpers: `formatSize()` for bytes to KB/MB, `formatDate()` for UTC timestamp to YYYY-MM-DD
  - Selection pattern: use `Set<number>` for selectedIds for O(1) lookup/add/delete operations
  - Table with max-height and overflow-y-auto for scrollable content with fixed header (sticky top-0)
---

## 2026-01-25 - US-038
- What was implemented:
  - Added `downloadLog()` method to `DroneConnection` class for downloading log data via MAVLink LOG_REQUEST_DATA/LOG_DATA protocol
  - Exported `DownloadProgress` and `DownloadedLog` interfaces for type-safe progress tracking
  - Added Download Selected button to DroneLogsPanel header with proper disabled state handling
  - Implemented progress bar with bytes received/total, percentage, and multi-log counter (e.g., "2 of 5")
  - Sequential download of multiple selected logs with progress tracking per log
  - Downloaded logs stored as Blobs in browser memory via `DownloadedLog` interface
  - Added download error and success notifications in the panel
- Files changed:
  - `frontend/src/lib/droneConnection.ts` (modified - added downloadLog method, DownloadProgress/DownloadedLog interfaces)
  - `frontend/src/components/DroneLogsPanel.tsx` (modified - added download button, progress bar, DownloadState management)
- **Learnings for future iterations:**
  - MAVLink log download protocol: send LOG_REQUEST_DATA(id, offset, count), receive LOG_DATA responses with offset+data chunks
  - Use Map<offset, Uint8Array> to collect chunks, then sort by offset and assemble into Blob
  - Progress tracking pattern: DownloadState object with isDownloading, currentLogId, currentProgress, completedCount, totalCount
  - Timeout pattern: reset timeout on each received chunk (10 second timeout), resolve partial or reject on timeout
  - Event handler interception: save original handler, restore in cleanup to avoid handler leaks
  - Multi-log download: loop through selected logs sequentially, track completedCount vs totalCount for UI
---

## 2026-01-25 - US-039
- What was implemented:
  - Added Upload buttons to DroneLogsPanel that appear after drone log download completes
  - Each downloaded log shows an "Upload Log {id}" button with upload icon
  - Button navigates to /upload with the downloaded Blob passed via React Router navigation state
  - Modified UploadPage to accept pre-populated file via `useLocation` hook
  - Converts Blob to File object with generated filename (log_{id}_{date}.ulg)
  - Added "Downloaded from drone" badge indicator when file came from drone connection
  - Added `fromDrone` state to track source of file and reset properly on file removal
  - Metadata extraction proceeds normally after file is populated
- Files changed:
  - `frontend/src/components/DroneLogsPanel.tsx` (modified - added handleUploadLog, Upload buttons)
  - `frontend/src/pages/UploadPage.tsx` (modified - added DroneLogState interface, useLocation hook, fromDrone state, drone badge)
- **Learnings for future iterations:**
  - React Router navigation state: use `navigate('/path', { state: { ... } })` to pass data between routes
  - Access navigation state via `useLocation().state` with type assertion to interface
  - Convert Blob to File: `new File([blob], filename, { type: 'application/octet-stream' })`
  - Clear navigation state after processing to prevent re-processing on refresh: `navigate(location.pathname, { replace: true, state: null })`
  - DroneLogsPanel tracks downloaded logs in downloadState.downloadedLogs array for post-download actions
---

## 2026-01-26 - US-040
- What was implemented:
  - Created `scripts/upload_log.py` Python CLI script for programmatic flight log uploads
  - Required arguments: `--file` (path to .ulg file), `--pilot`, `--drone-model` (XLT, S1, or CX10)
  - Optional arguments: `--title` (defaults to filename), `--comment`, `--tags` (comma-separated)
  - `--api-url` argument defaults to http://localhost:8000
  - Uploads via multipart form to POST /api/logs endpoint
  - Prints success message with created log ID on 201 response
  - Prints error message to stderr and exits with code 1 on failure
  - Added `requests>=2.31.0` to `backend/requirements.txt`
- Files changed:
  - `scripts/upload_log.py` (new)
  - `backend/requirements.txt` (modified - added requests dependency)
- **Learnings for future iterations:**
  - Python CLI pattern: use argparse with `formatter_class=argparse.RawDescriptionHelpFormatter` for docstring in help
  - For multipart file uploads: open file in `with` block, pass to `files` param as tuple `(filename, file_obj, content_type)`
  - Use `requests.post(url, data=form_data, files=files)` for multipart form uploads
  - Error handling: catch `requests.exceptions.ConnectionError` and `Timeout` separately for clearer error messages
  - Type stubs: install `types-requests` for mypy compatibility when using requests library
---

## 2026-01-26 - US-041
- What was implemented:
  - Configured FastAPI to serve frontend production build from `frontend/dist` at root path
  - Added `FRONTEND_DIST_DIR` setting to `backend/config.py` pointing to `frontend/dist`
  - Mounted `/assets` static files directory for Vite build assets (JS, CSS)
  - Implemented catch-all route `/{full_path:path}` for SPA client-side routing fallback
  - Route checks if requested file exists in dist folder, otherwise returns `index.html`
  - Conditional mounting: only mounts frontend if `frontend/dist` directory exists
  - Created `README.md` with development and production build documentation
  - Fixed minor TypeScript issues: removed unused variable in DroneLogsPanel, fixed Blob type in droneConnection
- Files changed:
  - `backend/config.py` (modified - added FRONTEND_DIST_DIR setting)
  - `backend/main.py` (modified - added /assets mount and SPA fallback route)
  - `README.md` (new)
  - `frontend/src/components/DroneLogsPanel.tsx` (modified - removed unused variable)
  - `frontend/src/lib/droneConnection.ts` (modified - fixed Blob type for TypeScript strictness)
- **Learnings for future iterations:**
  - SPA fallback pattern: catch-all route `/{full_path:path}` must be registered LAST to not override API routes
  - Check if file exists before returning index.html: `if file_path.is_file(): return FileResponse(file_path)`
  - Conditional mounting: wrap in `if settings.FRONTEND_DIST_DIR.exists():` to avoid errors in dev-only mode
  - Vite build outputs assets to `dist/assets/` subfolder with hashed filenames
  - For production: run `npm run build` in frontend/, then start uvicorn to serve everything
---
