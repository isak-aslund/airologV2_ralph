# Ralph Progress Log
Started: 2026-01-26

## Codebase Patterns
- Use Python virtual environment `.venv/` for backend dependencies
- Run typecheck with: `source .venv/bin/activate && mypy backend/ --ignore-missing-imports`
- Test FastAPI server with: `uvicorn backend.main:app --host 127.0.0.1 --port 8000`
- pydantic-settings required for BaseSettings with env vars support in Pydantic v2
- ULog parsing: use `pyulog.ULog(file_path)` - timestamps in microseconds, GPS as int*1e7, params via `.initial_parameters`
- Router pattern: create `backend/routers/{module}.py` with `APIRouter(prefix="/api/{resource}", tags=["{resource}"])`, register in main.py
- Tags are always stored lowercase; use `get_or_create_tags(db, tag_names)` helper for tag creation
- Frontend: Run npm commands from `frontend/` directory; typecheck with `npx tsc --noEmit`, build with `npm run build`
- Frontend: TailwindCSS v4 uses `@import "tailwindcss";` in CSS (not @tailwind directives)
- Test data files located in `test_data/` directory (5 .ulg files for upload testing)
- ULog timestamps: `start_timestamp` is boot-relative (not Unix epoch). Use `time_ref_utc` from `msg_info_dict` to get absolute time
- Flight date fallback: Parse from original filename if `time_ref_utc` is 0 (pattern: YYYY-MM-DD-HH-MM-SS)
- GPS sources in ULog (try in order): `vehicle_gps_position`, `sensor_gps`, `vehicle_local_position.ref_lat/ref_lon`

---

## 2026-01-26 - US-042
- What was implemented: Fixed flight_date extraction bug in ULog parser
- Files changed:
  - `backend/services/ulog_parser.py` - Added `_parse_date_from_filename()` helper, updated `extract_metadata()` to use `time_ref_utc` or filename fallback, improved GPS extraction to try multiple sources
  - `backend/routers/logs.py` - Pass original filename to `extract_metadata()`
- **Learnings for future iterations:**
  - ULog `start_timestamp` is NOT Unix epoch - it's microseconds since boot time
  - `time_ref_utc` in `msg_info_dict` provides the offset to convert to UTC
  - When uploading files, the mtime is lost (file is written fresh) - can't use mtime as fallback
  - Many test ULog files don't have GPS data (indoor tests) - this is expected, not a bug
---

